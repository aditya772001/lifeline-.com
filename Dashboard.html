<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hospital Dashboard | LifeLine+</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <div class="dashboard">
    <h2>üß† LifeLine+ Hospital Dashboard</h2>

    <div class="filter-box">
      <select id="filterOrgan">
        <option value="">All Organs</option>
        <option value="Kidney">Kidney</option>
        <option value="Liver">Liver</option>
        <option value="Heart">Heart</option>
        <option value="Lungs">Lungs</option>
      </select>
      <select id="filterBlood">
        <option value="">All Blood Groups</option>
        <option value="A+">A+</option>
        <option value="A-">A-</option>
        <option value="B+">B+</option>
        <option value="B-">B-</option>
        <option value="O+">O+</option>
        <option value="O-">O-</option>
        <option value="AB+">AB+</option>
        <option value="AB-">AB-</option>
      </select>
      <button onclick="loadData()">üîç Filter</button>
    </div>

    <div class="section">
      <h3>ü©∏ Registered Donors</h3>
      <table id="donorTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Organ</th>
            <th>Blood</th>
            <th>Contact</th>
            <th>City</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="section">
      <h3>üö® Organ Requests (Recipients)</h3>
      <table id="recipientTable">
        <thead>
          <tr>
            <th>Patient</th>
            <th>Organ</th>
            <th>Blood</th>
            <th>Hospital</th>
            <th>Contact</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>
  <script>
    const db = firebase.firestore();

    function loadData() {
      const organFilter = document.getElementById("filterOrgan").value;
      const bloodFilter = document.getElementById("filterBlood").value;

      // DONORS
      let donorQuery = db.collection("donors");
      if (organFilter) donorQuery = donorQuery.where("organ", "==", organFilter);
      if (bloodFilter) donorQuery = donorQuery.where("bloodGroup", "==", bloodFilter);

      donorQuery.get().then(snapshot => {
        const donorTable = document.getElementById("donorTable").getElementsByTagName("tbody")[0];
        donorTable.innerHTML = "";
        snapshot.forEach(doc => {
          const d = doc.data();
          donorTable.innerHTML += `
            <tr>
              <td>${d.name}</td>
              <td>${d.organ}</td>
              <td>${d.bloodGroup}</td>
              <td>${d.contact}</td>
              <td>${d.city}</td>
            </tr>`;
        });
      });

      // RECIPIENTS
      let recipientQuery = db.collection("recipients");
      if (organFilter) recipientQuery = recipientQuery.where("requiredOrgan", "==", organFilter);
      if (bloodFilter) recipientQuery = recipientQuery.where("bloodGroup", "==", bloodFilter);

      recipientQuery.get().then(snapshot => {
        const recipientTable = document.getElementById("recipientTable").getElementsByTagName("tbody")[0];
        recipientTable.innerHTML = "";
        snapshot.forEach(doc => {
          const r = doc.data();
          recipientTable.innerHTML += `
            <tr>
              <td>${r.patientName}</td>
              <td>${r.requiredOrgan}</td>
              <td>${r.bloodGroup}</td>
              <td>${r.hospital}</td>
              <td>${r.contact}</td>
            </tr>`;
        });
      });
    }

    // Load everything on page load
    window.onload = loadData;
  </script>

</body>
</html>
